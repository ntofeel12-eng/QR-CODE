<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Enterprise QR Generator PWA</title>

<!-- PWA Manifest -->
<link rel="manifest" href="data:application/manifest+json,{
  &quot;name&quot;:&quot;Enterprise QR Generator&quot;,
  &quot;short_name&quot;:&quot;QR Generator&quot;,
  &quot;description&quot;:&quot;Offline QR code generator with branding, history, PDF export&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#eef2f7&quot;,
  &quot;theme_color&quot;:&quot;#4f46e5&quot;,
  &quot;icons&quot;:[
    {&quot;src&quot;:&quot;https://via.placeholder.com/192&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;},
    {&quot;src&quot;:&quot;https://via.placeholder.com/512&quot;,&quot;sizes&quot;:&quot;512x512&quot;,&quot;type&quot;:&quot;image/png&quot;}
  ]
}">

<meta name="theme-color" content="#4f46e5">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="QR Generator">

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
/* --- Global --- */
body{background:linear-gradient(135deg,#eef2f7,#f9fbff);font-family:"Segoe UI",system-ui;min-height:100vh;display:flex;flex-direction:column;margin:0;}
.container{max-width:780px;margin:auto;padding-bottom:env(safe-area-inset-bottom);}
.app-header{background:linear-gradient(135deg,#4f46e5,#6366f1);color:white;padding:25px;border-radius:18px;margin-bottom:25px;box-shadow:0 12px 45px rgba(79,70,229,.35);text-align:center;transition:transform 0.3s;}
.app-header:hover{transform:scale(1.02);}
.card{border-radius:18px;border:none;box-shadow:0 12px 50px rgba(0,0,0,.08);padding:25px;margin-bottom:30px;transition:transform 0.3s;}
.card:hover{transform:translateY(-3px);}
.form-label{font-weight:600;color:#374151;margin-top:1rem;}
.form-control,.form-select{border-radius:12px;padding:14px;font-size:1rem;box-shadow:inset 0 1px 4px rgba(0,0,0,.08);}
#qrPreview{min-height:260px;display:flex;justify-content:center;align-items:center;background:#f8fafc;border-radius:18px;border:2px dashed #c7d2fe;overflow:hidden;margin-top:1rem;position:relative;transition:all 0.3s;}
#qrPreview:hover{background:#eef2ff;transform:scale(1.02);}
#qrLogo{position:absolute;width:50px;height:50px;border-radius:50%;pointer-events:none;transition:transform 0.3s;}
.sticky-bottom{position:sticky;bottom:0;background:#fff;padding:12px;border-top:1px solid #e5e7eb;z-index:10;}
.download-btn{background:linear-gradient(135deg,#22c55e,#16a34a);border:none;padding:16px;font-size:18px;border-radius:14px;box-shadow:0 10px 25px rgba(34,197,94,.4);color:white;transition:all 0.2s;}
.download-btn:hover{transform:translateY(-1px);box-shadow:0 14px 30px rgba(34,197,94,.55);}
.color-picker{width:50px;height:50px;border-radius:50%;border:2px solid #c7d2fe;cursor:pointer;margin-right:10px;}
.color-label{display:flex;align-items:center;margin-top:10px;}
/* --- Tabs --- */
.nav-tabs .nav-link{font-weight:600;color:#4f46e5;}
.nav-tabs .nav-link.active{background:#4f46e5;color:white;border-radius:10px;}
.tab-content{margin-top:20px;}
.history-item{display:flex;align-items:center;justify-content:space-between;padding:10px 15px;border-radius:12px;background:#f8f8f8;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,.05);}
.history-item img{width:50px;height:50px;border-radius:12px;}
.history-item button{border:none;background:linear-gradient(135deg,#6366f1,#4f46e5);color:white;padding:6px 12px;border-radius:10px;cursor:pointer;transition:0.2s;}
.history-item button:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(0,0,0,.2);}
</style>
</head>
<body>

<div class="container">

<div class="app-header">
<h2><i class="bi bi-qr-code-scan"></i> Enterprise QR Generator</h2>
<small>Offline QR code generator with branding, history & PDF export</small>
</div>

<!-- Tabs -->
<ul class="nav nav-tabs" id="mainTabs" role="tablist">
  <li class="nav-item"><a class="nav-link active" id="gen-tab" data-bs-toggle="tab" href="#generate" role="tab">Generate QR</a></li>
  <li class="nav-item"><a class="nav-link" id="hist-tab" data-bs-toggle="tab" href="#history" role="tab">History</a></li>
  <li class="nav-item"><a class="nav-link" id="settings-tab" data-bs-toggle="tab" href="#settings" role="tab">Settings</a></li>
</ul>

<div class="tab-content">

<!-- --- Generate QR Tab --- -->
<div class="tab-pane fade show active" id="generate" role="tabpanel">
<div class="card">
<label class="form-label" for="qrText">Text or URL</label>
<input id="qrText" class="form-control" placeholder="https://example.com">

<label class="form-label" for="qrSize">QR Size</label>
<select id="qrSize" class="form-select">
<option value="150">Small</option>
<option value="250" selected>Medium</option>
<option value="350">Large</option>
<option value="450">Extra Large</option>
</select>

<div class="color-label">
<label for="qrColor" class="form-label me-2">QR Color</label>
<input type="color" id="qrColor" class="color-picker" value="#000000">
<label for="bgColor" class="form-label me-2 ms-3">Background</label>
<input type="color" id="bgColor" class="color-picker" value="#ffffff">
</div>

<div class="color-label">
<label for="logoURL" class="form-label me-2">Optional Logo URL</label>
<input type="text" id="logoURL" class="form-control" placeholder="https://example.com/logo.png">
</div>

<label class="form-label mt-3">Live Preview</label>
<div id="qrPreview"><span class="text-muted">Start typing to see preview</span></div>

<div class="mt-3 d-flex justify-content-between">
<button class="download-btn w-100" onclick="generatePdf()">Download QR PDF</button>
</div>
</div>
</div>

<!-- --- History Tab --- -->
<div class="tab-pane fade" id="history" role="tabpanel">
<div id="historyList"></div>
</div>

<!-- --- Settings Tab --- -->
<div class="tab-pane fade" id="settings" role="tabpanel">
<div class="card">
<label class="form-label" for="defaultQRColor">Default QR Color</label>
<input type="color" id="defaultQRColor" class="color-picker" value="#000000">
<label class="form-label mt-3" for="defaultBGColor">Default Background</label>
<input type="color" id="defaultBGColor" class="color-picker" value="#ffffff">
<label class="form-label mt-3" for="defaultLogoURL">Default Logo URL</label>
<input type="text" id="defaultLogoURL" class="form-control" placeholder="https://example.com/logo.png">
<button class="download-btn w-100 mt-4" onclick="saveSettings()">Save Settings</button>
</div>
</div>

</div> <!-- tab-content -->

</div> <!-- container -->

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
// --- QR Generate & Preview ---
const qrText=document.getElementById('qrText');
const qrSize=document.getElementById('qrSize');
const qrPreview=document.getElementById('qrPreview');
const qrColor=document.getElementById('qrColor');
const bgColor=document.getElementById('bgColor');
const logoURL=document.getElementById('logoURL');
let qrInstance, logoImg;

function updatePreview(){
    const text=qrText.value.trim();
    const size=parseInt(qrSize.value);
    const fg=qrColor.value;
    const bg=bgColor.value;
    const logoSrc=logoURL.value.trim();
    qrPreview.innerHTML='';
    if(!text){qrPreview.innerHTML='<span class="text-muted">Start typing to see preview</span>'; return;}
    qrInstance=new QRCode(qrPreview,{
        text:text,width:size,height:size,colorDark:fg,colorLight:bg,correctLevel:QRCode.CorrectLevel.H
    });
    if(logoSrc){
        logoImg=new Image(); logoImg.src=logoSrc; logoImg.id='qrLogo';
        logoImg.onload=()=>{qrPreview.appendChild(logoImg);}
    }
}
[qrText, qrSize, qrColor, bgColor, logoURL].forEach(el=>el.addEventListener('input',updatePreview));

// --- PDF Generation ---
function generatePdf(){
    if(!qrText.value.trim()){alert('Enter text first');return;}
    const imgEl=qrPreview.querySelector('img');
    if(!imgEl){alert('Generate QR first'); return;}
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF();
    const size=parseInt(qrSize.value);
    doc.text('QR Code',105,20,null,null,'center');
    doc.addImage(imgEl.src,'PNG',(210-size)/2,30,size,size);
    if(logoImg) doc.addImage(logoImg.src,'PNG',(210-50)/2,30+(size/2)-25,50,50);
    doc.save('Enterprise_QR_Code.pdf');
    saveHistory(imgEl.src);
}

// --- History Management ---
function saveHistory(dataURL){
    let history=JSON.parse(localStorage.getItem('qrHistory')||'[]');
    history.unshift({time:Date.now(), data:dataURL});
    localStorage.setItem('qrHistory',JSON.stringify(history));
    renderHistory();
}
function renderHistory(){
    const list=document.getElementById('historyList');
    list.innerHTML='';
    let history=JSON.parse(localStorage.getItem('qrHistory')||'[]');
    if(history.length===0){list.innerHTML='<p class="text-muted">No history yet.</p>'; return;}
    history.forEach((h,i)=>{
        const div=document.createElement('div'); div.className='history-item';
        div.innerHTML=`<img src="${h.data}"><span>${new Date(h.time).toLocaleString()}</span>
        <button onclick="downloadHistory(${i})">Download PDF</button>`;
        list.appendChild(div);
    });
}
function downloadHistory(index){
    let history=JSON.parse(localStorage.getItem('qrHistory')||'[]');
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF();
    const img=history[index].data;
    doc.text('QR Code',105,20,null,null,'center');
    doc.addImage(img,'PNG',30,30,150,150);
    doc.save('QR_History_'+index+'.pdf');
}

// --- Settings Management ---
function saveSettings(){
    const settings={qrColor:defaultQRColor.value,bgColor:defaultBGColor.value,logoURL:defaultLogoURL.value};
    localStorage.setItem('qrSettings',JSON.stringify(settings));
    alert('Settings saved!');
}
function loadSettings(){
    const settings=JSON.parse(localStorage.getItem('qrSettings')||'{}');
    if(settings.qrColor) qrColor.value=settings.qrColor;
    if(settings.bgColor) bgColor.value=settings.bgColor;
    if(settings.logoURL) logoURL.value=settings.logoURL;
    if(settings.qrColor) defaultQRColor.value=settings.qrColor;
    if(settings.bgColor) defaultBGColor.value=settings.bgColor;
    if(settings.logoURL) defaultLogoURL.value=settings.logoURL;
    updatePreview();
    renderHistory();
}
window.onload=loadSettings;

// --- Service Worker / Offline ---
const OFFLINE_HTML='data:text/html,'+encodeURIComponent('<!DOCTYPE html><html><head><title>Offline</title><meta name="viewport" content="width=device-width, initial-scale=1"><style>body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;font-family:sans-serif;text-align:center;background:#fefefe;color:#333;}h1{font-size:2rem;margin-bottom:1rem;}p{font-size:1.1rem;color:#666;}</style></head><body><div><h1>⚠️ You Are Offline</h1><p>The QR Generator app is offline.<br>Check your connection and try again.</p></div></body></html>');
if('serviceWorker' in navigator){
    const SW_CODE=`
    const CACHE_NAME='qr-generator-pwa-v5';
    const ASSETS=['.','https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css','https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css','https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js','https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js','https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js'];
    self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(ASSETS))));
    self.addEventListener('activate',e=>e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==CACHE_NAME).map(k=>caches.delete(k))))));
    self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).catch(()=>Response.redirect('${OFFLINE_HTML}')))));
    `;
    const blob=new Blob([SW_CODE],{type:'application/javascript'});
    navigator.serviceWorker.register(URL.createObjectURL(blob)).then(()=>console.log('SW Registered')).catch(err=>console.error(err));
}
</script>

</body>
</html>
